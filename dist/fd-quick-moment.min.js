(function(){var a;a=angular.module("fdQuickMoment",[]),a.provider("fdQuickMomentDefaults",function(){return{options:{dateFormat:"M/d/yyyy",timeFormat:"h:mm a",labelFormat:null,placeholder:"Click to Set Date",hoverText:null,buttonIconHtml:null,closeButtonHtml:"&times;",nextLinkHtml:"Next &rarr;",prevLinkHtml:"&larr; Prev",disableTimepicker:!1,disableClearButton:!1,defaultTime:null,dayAbbreviations:["Su","M","Tu","W","Th","F","Sa"],dateFilter:null,parseDateFunction:function(a){var b;return b=Date.parse(a),isNaN(b)?null:new Date(b)}},$get:function(){return this.options},set:function(a,b){var c,d,e;if("object"==typeof a){e=[];for(c in a)d=a[c],e.push(this.options[c]=d);return e}return this.options[a]=b}}}),a.directive("datepicker",["fdQuickMomentDefaults","$filter","$sce",function(a,b,c){return{restrict:"E",require:"ngModel",scope:{dateFilter:"=?",ngModel:"=",onChange:"&"},replace:!0,link:function(d,e,f){var g,h,i,j,k,l,m,n,o,p,q,r,s;return k=f.debug&&f.debug.length,m=function(){return d.toggleCalendar(!1),d.weeks=[],d.inputDate=null,"string"==typeof d.ngModel&&(d.ngModel=n(d.ngModel)),"string"==typeof f.initValue&&(d.ngModel=n(f.initValue)),q(),r(),o()},q=function(){var b,e;for(b in a)e=a[b],b.match(/[Hh]tml/)?d[b]=c.trustAsHtml(a[b]||""):!d[b]&&f[b]?d[b]=f[b]:d[b]||(d[b]=a[b]);return d.labelFormat||(d.labelFormat=d.dateFormat,d.disableTimepicker||(d.labelFormat+=" "+d.timeFormat)),f.iconClass&&f.iconClass.length?d.buttonIconHtml=c.trustAsHtml("<i ng-show='iconClass' class='"+f.iconClass+"'></i>"):void 0},h=!1,window.document.addEventListener("click",function(){return h||(d.toggleCalendar(!1),d.$apply()),h=!1}),angular.element(e[0])[0].addEventListener("click",function(){return h=!0}),r=function(){return d.ngModel?(d.inputDate=b("date")(d.ngModel,d.dateFormat),d.inputTime=b("date")(d.ngModel,d.timeFormat)):(d.inputDate=null,d.inputTime=null)},o=function(){var a;return a=d.ngModel?new Date(d.ngModel):new Date,"Invalid Date"===a.toString()&&(a=new Date),a.setDate(1),d.calendarDate=new Date(a)},p=function(){var a,b,c,e,f,g,h,j,k,m,n,o,p,q;for(g=d.calendarDate.getDay(),e=l(d.calendarDate.getFullYear(),d.calendarDate.getMonth()),f=Math.ceil((g+e)/7),n=[],a=new Date(d.calendarDate),a.setDate(a.getDate()+-1*g),h=o=0,q=f-1;q>=0?q>=o:o>=q;h=q>=0?++o:--o)for(n.push([]),c=p=0;6>=p;c=++p)b=new Date(a),d.defaultTime&&(k=d.defaultTime.split(":"),b.setHours(k[0]||0),b.setMinutes(k[1]||0),b.setSeconds(k[2]||0)),j=d.ngModel&&b&&i(b,d.ngModel),m=i(b,new Date),n[h].push({date:b,selected:j,disabled:"function"==typeof d.dateFilter?!d.dateFilter(b):!1,other:b.getMonth()!==d.calendarDate.getMonth(),today:m}),a.setDate(a.getDate()+1);return d.weeks=n},g=function(a,c){return b("date")(a,c)},s=function(a){return"string"==typeof a?n(a):a},n=a.parseDateFunction,i=function(a,b,c){return null==c&&(c=!1),c?a-b===0:(a=s(a),b=s(b),a&&b&&a.getYear()===b.getYear()&&a.getMonth()===b.getMonth()&&a.getDate()===b.getDate())},j=function(a,b){return a&&b?parseInt(a.getTime()/6e4)===parseInt(b.getTime()/6e4):!1},l=function(a,b){return[31,a%4===0&&a%100!==0||a%400===0?29:28,31,30,31,30,31,31,30,31,30,31][b]},d.$watch("ngModel",function(a,b){return a!==b&&(r(),o(),d.onChange&&!j(a,b))?d.onChange():void 0}),d.$watch("calendarDate",function(a,b){return a!==b?p():void 0}),d.$watch("calendarShown",function(){var a;return a=angular.element(e[0].querySelector(".quickmoment-date-input"))[0],a.select()}),d.mainButtonStr=function(){return d.ngModel?b("date")(d.ngModel,d.labelFormat):d.placeholder},d.toggleCalendar=function(a){return d.calendarShown=isFinite(a)?a:!d.calendarShown},d.setDate=function(a,b){var c;return null==b&&(b=!0),c=!d.ngModel&&a||d.ngModel&&!a||a.getTime()!==s(d.ngModel).getTime(),"function"!=typeof d.dateFilter||d.dateFilter(a)?(d.ngModel=a,b&&d.toggleCalendar(!1),!0):!1},d.setDateFromInput=function(a){var b,c,e,f;null==a&&(a=!1);try{if(c=n(d.inputDate),!c)throw"Invalid Date";if(!d.disableTimepicker&&d.inputTime&&d.inputTime.length&&c){if(f=d.disableTimepicker?"00:00:00":d.inputTime,e=n(""+d.inputDate+" "+f),!e)throw"Invalid Time";c=e}if(!j(d.ngModel,c)&&!d.setDate(c,!1))throw"Invalid Date";return a&&d.toggleCalendar(!1),d.inputDateErr=!1,d.inputTimeErr=!1}catch(g){if(b=g,"Invalid Date"===b)return d.inputDateErr=!0;if("Invalid Time"===b)return d.inputTimeErr=!0}},d.onDateInputTab=function(){return d.disableTimepicker&&d.toggleCalendar(!1),!0},d.onTimeInputTab=function(){return d.toggleCalendar(!1),!0},d.nextMonth=function(){return d.calendarDate=new Date(new Date(d.calendarDate).setMonth(d.calendarDate.getMonth()+1))},d.prevMonth=function(){return d.calendarDate=new Date(new Date(d.calendarDate).setMonth(d.calendarDate.getMonth()-1))},d.clear=function(){return d.setDate(null,!0)},m(),p(),k?console.log("quick date scope:",d):void 0},template:"<div class='quickmoment'>\n  <a href='' ng-focus='toggleCalendar()' ng-click='toggleCalendar()' class='quickmoment-button' title='{{hoverText}}'><div ng-hide='iconClass' ng-bind-html='buttonIconHtml'></div>{{mainButtonStr()}}</a>\n  <div class='quickmoment-popup' ng-class='{open: calendarShown}'>\n    <a href='' tabindex='-1' class='quickmoment-close' ng-click='toggleCalendar()'><div ng-bind-html='closeButtonHtml'></div></a>\n    <div class='quickmoment-text-inputs'>\n      <div class='quickmoment-input-wrapper'>\n        <label>Date</label>\n        <input class='quickmoment-date-input' name='inputDate' type='text' ng-model='inputDate' placeholder='1/1/2013' ng-blur=\"setDateFromInput()\" ng-enter=\"setDateFromInput(true)\" ng-class=\"{'quickmoment-error': inputDateErr}\" on-tab='onDateInputTab()' />\n      </div>\n      <div class='quickmoment-input-wrapper' ng-hide='disableTimepicker'>\n        <label>Time</label>\n        <input class='quickmoment-time-input' name='inputTime' type='text' ng-model='inputTime' placeholder='12:00 PM' ng-blur=\"setDateFromInput(false)\" ng-enter=\"setDateFromInput(true)\" ng-class=\"{'quickmoment-error': inputTimeErr}\" on-tab='onTimeInputTab()'>\n      </div>\n    </div>\n    <div class='quickmoment-calendar-header'>\n      <a href='' class='quickmoment-prev-month quickmoment-action-link' tabindex='-1' ng-click='prevMonth()'><div ng-bind-html='prevLinkHtml'></div></a>\n      <span class='quickmoment-month'>{{calendarDate | date:'MMMM yyyy'}}</span>\n      <a href='' class='quickmoment-next-month quickmoment-action-link' ng-click='nextMonth()' tabindex='-1' ><div ng-bind-html='nextLinkHtml'></div></a>\n    </div>\n    <table class='quickmoment-calendar'>\n      <thead>\n        <tr>\n          <th ng-repeat='day in dayAbbreviations'>{{day}}</th>\n        </tr>\n      </thead>\n      <tbody>\n        <tr ng-repeat='week in weeks'>\n          <td ng-mousedown='setDate(day.date)' ng-class='{\"other-month\": day.other, \"disabled-date\": day.disabled, \"selected\": day.selected, \"is-today\": day.today}' ng-repeat='day in week'>{{day.date | date:'d'}}</td>\n        </tr>\n      </tbody>\n    </table>\n    <div class='quickmoment-popup-footer'>\n      <a href='' class='quickmoment-clear' tabindex='-1' ng-hide='disableClearButton' ng-click='clear()'>Clear</a>\n    </div>\n  </div>\n</div>"}}]),a.directive("ngEnter",function(){return function(a,b,c){return b.bind("keydown keypress",function(b){return 13===b.which?(a.$apply(c.ngEnter),b.preventDefault()):void 0})}}),a.directive("onTab",function(){return{restrict:"A",link:function(a,b,c){return b.bind("keydown keypress",function(b){return 9!==b.which||b.shiftKey?void 0:a.$apply(c.onTab)})}}})}).call(this);