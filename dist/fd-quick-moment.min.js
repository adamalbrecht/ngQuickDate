(function(){var a;a=angular.module("fdQuickMoment",[]),a.provider("fdQuickMomentDefaults",function(){return{options:{dateFormat:"M/D/YYYY",timeFormat:"h:mm A",labelFormat:null,placeholder:"Click to Set Date",hoverText:null,buttonIconHtml:null,closeButtonHtml:"&times;",nextLinkHtml:"Next &rarr;",prevLinkHtml:"&larr; Prev",disableTimepicker:!1,disableDateinput:!1,disableClearButton:!1,defaultTime:null,dayAbbreviations:["Su","M","Tu","W","Th","F","Sa"],dateFilter:null,timezone:"America/Chicago",parseDateFunction:function(a){var b;return b=moment(a),b.isValid()?b:null}},$get:function(){return this.options},set:function(a,b){var c,d,e;if("object"==typeof a){e=[];for(c in a)d=a[c],e.push(this.options[c]=d);return e}return this.options[a]=b}}}),a.directive("momentpicker",["fdQuickMomentDefaults","$filter","$sce",function(a,b,c){return{restrict:"E",require:"ngModel",scope:{dateFilter:"=?",ngModel:"=",onChange:"&"},replace:!0,link:function(b,d,e){var f,g,h,i,j,k,l,m,n,o,p,q;return j=e.debug&&e.debug.length,k=function(){return b.toggleCalendar(!1),b.weeks=[],b.inputDate=null,b.timezone=e.timezone,"string"==typeof b.ngModel&&(b.ngModel=l(b.ngModel)),"string"==typeof e.initValue&&(b.ngModel=l(e.initValue)),o(),p(),m()},o=function(){var d,f;for(d in a)f=a[d],d.match(/[Hh]tml/)?b[d]=c.trustAsHtml(a[d]||""):!b[d]&&e[d]?b[d]=e[d]:b[d]||(b[d]=a[d]);if(b.labelFormat||(b.labelFormat=b.dateFormat,b.disableTimepicker||(b.labelFormat+=" "+b.timeFormat)),e.iconClass&&e.iconClass.length&&(b.buttonIconHtml=c.trustAsHtml("<i ng-show='iconClass' class='"+e.iconClass+"'></i>")),void 0===b.timezone)throw"timezone required"},g=!1,window.document.addEventListener("click",function(){return g||(b.toggleCalendar(!1),b.$apply()),g=!1}),angular.element(d[0])[0].addEventListener("click",function(){return g=!0}),p=function(){return b.ngModel?(b.inputDate=b.ngModel.format(b.dateFormat),b.inputTime=b.ngModel.format(b.timeFormat)):(b.inputDate=null,b.inputTime=null)},m=function(){var a;return a=b.ngModel?moment(b.ngModel).tz(b.timezone):moment().tz(b.timezone),void 0!==a&&a.isValid()||(a=moment().tz(b.timezone)),b.calendarDate=a.startOf("month").tz(b.timezone)},n=function(){var a,c,d,e,f,g,i,j,k,l,m,n,o,p;for(g=b.calendarDate.day(),e=b.calendarDate.daysInMonth(),f=Math.ceil((g+e)/7),m=[],a=moment(b.calendarDate).tz(b.timezone),a.add("d",-1*g),i=n=0,p=f-1;p>=0?p>=n:n>=p;i=p>=0?++n:--n)for(m.push([]),d=o=0;6>=o;d=++o)c=moment(a).tz(b.timezone),b.defaultTime&&(k=b.defaultTime.split(":"),c.hours(k[0]||0),c.minutes(k[1]||0),c.seconds(k[2]||0)),j=b.ngModel&&c&&h(c,b.ngModel),l=h(c,moment().tz(b.timezone)),m[i].push({date:c,selected:j,disabled:"function"==typeof b.dateFilter?!b.dateFilter(c):!1,other:c.month()!==b.calendarDate.month(),today:l}),a.add("d",1);return b.weeks=m},f=function(a,b){return a.format(b)},q=function(a){return"string"==typeof a?l(a):a},l=a.parseDateFunction,h=function(a,b,c){return null==c&&(c=!1),c?a.unix()===b.unix():(a=q(a),b=q(b),a.year()===b.year()&&a.month()===b.month()&&a.date()===b.date())},i=function(a,b){return a&&b?a.year()===b.year()&&a.month()===b.month()&&a.date()===b.date()&&a.hour()===b.hour()&&a.minute()===b.minute():!1},b.$watch("ngModel",function(a,c){return a!==c&&(p(),m(),b.onChange&&!i(a,c))?b.onChange():void 0}),b.$watch("calendarDate",function(a,b){return a!==b?n():void 0}),b.$watch("calendarShown",function(){var a;return a=angular.element(d[0].querySelector(".quickmoment-date-input"))[0],a.select()}),b.mainButtonStr=function(){return b.ngModel?b.ngModel.format(b.labelFormat):b.placeholder},b.toggleCalendar=function(a){return b.calendarShown=isFinite(a)?a:!b.calendarShown},b.setDate=function(a,c){var d,e,f;return null==c&&(c=!0),d=!b.ngModel&&a||b.ngModel&&!a||a.unix()!==q(b.ngModel).unix(),"function"!=typeof b.dateFilter||b.dateFilter(a)?(b.disableTimepicker&&b.ngModel&&(e=b.ngModel.hours(),f=b.ngModel.minutes(),a=a.hours(e).minutes(f)),b.ngModel=a,c&&b.toggleCalendar(!1),!0):!1},b.setDateFromInput=function(a){var c,d,e,f;null==a&&(a=!1);try{if(d=l(b.inputDate),!d)throw"Invalid Date";if(!b.disableTimepicker&&b.inputTime&&b.inputTime.length&&d){if(f=b.disableTimepicker?"00:00:00":b.inputTime,e=l(""+b.inputDate+" "+f),!e)throw"Invalid Time";d=e}if(!i(b.ngModel,d)&&!b.setDate(d,!1))throw"Invalid Date";return a&&b.toggleCalendar(!1),b.inputDateErr=!1,b.inputTimeErr=!1}catch(g){if(c=g,"Invalid Date"===c)return b.inputDateErr=!0;if("Invalid Time"===c)return b.inputTimeErr=!0}},b.onDateInputTab=function(){return b.disableTimepicker&&b.toggleCalendar(!1),!0},b.onTimeInputTab=function(){return b.toggleCalendar(!1),!0},b.nextMonth=function(){return b.calendarDate=moment(b.calendarDate).tz(b.timezone).add("M",1)},b.prevMonth=function(){return b.calendarDate=moment(b.calendarDate).tz(b.timezone).subtract("M",1)},b.clear=function(){return b.setDate(null,!0)},k(),n(),j?console.log("quick date scope:",b):void 0},template:"<div class='quickmoment'>\n  <a href='' ng-focus='toggleCalendar()' ng-click='toggleCalendar()' class='quickmoment-button' title='{{hoverText}}'><div ng-hide='iconClass' ng-bind-html='buttonIconHtml'></div>{{mainButtonStr()}}</a>\n  <div class='quickmoment-popup' ng-class='{open: calendarShown}'>\n    <a href='' tabindex='-1' class='quickmoment-close' ng-click='toggleCalendar()'><div ng-bind-html='closeButtonHtml'></div></a>\n    <div class='quickmoment-text-inputs'>\n      <div class='quickmoment-input-wrapper' ng-hide='disableDateinput'>\n        <label>Date</label>\n        <input class='quickmoment-date-input' name='inputDate' type='text' ng-model='inputDate' placeholder='1/1/2013' ng-blur=\"setDateFromInput()\" ng-enter=\"setDateFromInput(true)\" ng-class=\"{'quickmoment-error': inputDateErr}\" on-tab='onDateInputTab()'/>\n      </div>\n      <div class='quickmoment-input-wrapper' ng-hide='disableTimepicker'>\n        <label>Time</label>\n        <input class='quickmoment-time-input' name='inputTime' type='text' ng-model='inputTime' placeholder='12:00 PM' ng-blur=\"setDateFromInput(false)\" ng-enter=\"setDateFromInput(true)\" ng-class=\"{'quickmoment-error': inputTimeErr}\" on-tab='onTimeInputTab()'>\n      </div>\n    </div>\n    <div class='quickmoment-calendar-header'>\n      <a href='' class='quickmoment-prev-month quickmoment-action-link' tabindex='-1' ng-click='prevMonth()'><div ng-bind-html='prevLinkHtml'></div></a>\n      <span class='quickmoment-month'>{{calendarDate | moment:'MMMM YYYY'}}</span>\n      <a href='' class='quickmoment-next-month quickmoment-action-link' ng-click='nextMonth()' tabindex='-1' ><div ng-bind-html='nextLinkHtml'></div></a>\n    </div>\n    <table class='quickmoment-calendar'>\n      <thead>\n        <tr>\n          <th ng-repeat='day in dayAbbreviations'>{{day}}</th>\n        </tr>\n      </thead>\n      <tbody>\n        <tr ng-repeat='week in weeks'>\n          <td ng-mousedown='setDate(day.date)' ng-class='{\"other-month\": day.other, \"disabled-date\": day.disabled, \"selected\": day.selected, \"is-today\": day.today}' ng-repeat='day in week'>{{day.date | moment:'D'}}</td>\n        </tr>\n      </tbody>\n    </table>\n    <div class='quickmoment-popup-footer'>\n      <a href='' class='quickmoment-clear' tabindex='-1' ng-hide='disableClearButton' ng-click='clear()'>Clear</a>\n    </div>\n  </div>\n</div>"}}]),a.directive("ngEnter",function(){return function(a,b,c){return b.bind("keydown keypress",function(b){return 13===b.which?(a.$apply(c.ngEnter),b.preventDefault()):void 0})}}),a.directive("onTab",function(){return{restrict:"A",link:function(a,b,c){return b.bind("keydown keypress",function(b){return 9!==b.which||b.shiftKey?void 0:a.$apply(c.onTab)})}}}),a.filter("moment",function(){return function(a,b){return a.format(b)}})}).call(this);